{
    "417ec7b1-4a2d-614d-0a5a-19dd3b43ab65": {
        "accepts": [], 
        "body": "#!/usr/bin/python\n\nimport traceback\nimport json\n\nfrom time import strftime, localtime\n\nfrom valarie.dao.document import Collection\n\nchart_page_1 = \"\"\"<div style=\"width:inherit;height:calc(100vh - 250px);\">\n    <img src=\"/images/throbber.gif\" onload='\n        var chart;\n        var graph;\n            \n        chart = new AmCharts.AmSerialChart();\n\n        chart.dataProvider = \"\"\"\nchart_page_2 = \"\"\";\n        chart.marginLeft = 10;\n        chart.categoryField = \"datetime\";\n        chart.dataDateFormat = \"YYYY/MM/DD JJ:NN\";\n        \n        chart.synchronizeGrid = true; // this makes all axes grid to be at the same intervals\n        \n        chart[\"export\"] = {\"enabled\" : true};\n        \n        chart[\"titles\"] = [{\"text\" : \"Localhost Memory\"}];\n        \n        // AXES\n        // category\n        var categoryAxis = chart.categoryAxis;\n        categoryAxis.parseDates = true; // as our data is date-based, we set parseDates to true\n        categoryAxis.minPeriod = \"mm\"; // our data is yearly, so we set minPeriod to YYYY\n        categoryAxis.dashLength = 3;\n        categoryAxis.minorGridEnabled = true;\n        categoryAxis.minorGridAlpha = 0.1;\n        categoryAxis.twoLineMode = true;\n        categoryAxis.title = \"Time\";\n\n        // value\n        var valueAxis1 = new AmCharts.ValueAxis();\n        valueAxis1.axisThickness = 2;\n        valueAxis1.title = \"MB\";\n        chart.addValueAxis(valueAxis1);\n        \n        // GRAPH\n        graph1 = new AmCharts.AmGraph();\n        //graph1.type = \"smoothedLine\"; // this line makes the graph smoothed line.\n        graph1.valueAxis = valueAxis1;\n        graph1.valueField = \"free\";\n        graph1.title = \"free\";\n        //graph1.bullet = \"round\";\n        //graph1.fillAlphas = 0.2;\n        graph1.lineThickness = 2;\n        chart.addGraph(graph1);\n        \n        graph2 = new AmCharts.AmGraph();\n        //graph2.type = \"smoothedLine\"; // this line makes the graph smoothed line.\n        graph2.valueAxis = valueAxis1;\n        graph2.valueField = \"used\";\n        graph2.title = \"used\";\n        //graph2.bullet = \"round\";\n        //graph2.fillAlphas = 0.2;\n        graph2.lineThickness = 2;\n        chart.addGraph(graph2);\n        \n        graph3 = new AmCharts.AmGraph();\n        //graph3.type = \"smoothedLine\"; // this line makes the graph smoothed line.\n        graph3.valueAxis = valueAxis1;\n        graph3.valueField = \"cache\";\n        graph3.title = \"cache\";\n        //graph3.bullet = \"round\";\n        //graph3.fillAlphas = 0.2;\n        graph3.lineThickness = 2;\n        chart.addGraph(graph3);\n        \n        graph4 = new AmCharts.AmGraph();\n        //graph4.type = \"smoothedLine\"; // this line makes the graph smoothed line.\n        graph4.valueAxis = valueAxis1;\n        graph4.valueField = \"free+cache\";\n        graph4.title = \"free+cache\";\n        //graph4.bullet = \"round\";\n        //graph4.fillAlphas = 0.2;\n        graph4.lineThickness = 2;\n        chart.addGraph(graph4);\n        \n        graph5 = new AmCharts.AmGraph();\n        //graph5.type = \"smoothedLine\"; // this line makes the graph smoothed line.\n        graph5.valueAxis = valueAxis1;\n        graph5.valueField = \"total\";\n        graph5.title = \"total\";\n        //graph5.bullet = \"round\";\n        //graph5.fillAlphas = 0.2;\n        graph5.lineThickness = 2;\n        chart.addGraph(graph5);\n        \n        // CURSOR\n        var chartCursor = new AmCharts.ChartCursor();\n        chartCursor.cursorAlpha = 0.1;\n        chartCursor.fullWidth = true;\n        chartCursor.valueLineBalloonEnabled = true;\n        chartCursor.categoryBalloonDateFormat = \"YYYY/MM/DD JJ:NN\";\n        chart.addChartCursor(chartCursor);\n\n        // SCROLLBAR\n        var chartScrollbar = new AmCharts.ChartScrollbar();\n        chart.addChartScrollbar(chartScrollbar);\n        \n        // LEGEND\n        var legend = new AmCharts.AmLegend();\n        legend.marginLeft = 110;\n        legend.useGraphSettings = true;\n        chart.addLegend(legend);\n        \n        // WRITE\n        chart.write(this.parentNode);\n    '>\n</div>\"\"\"\n\nclass Task:\n    def __init__(self):\n        self.output = []\n        self.status = STATUS_NOT_EXECUTED\n\n    def execute(self, cli):\n        try:\n            grid_data = []\n            \n            metrics = Collection(\"metrics\")\n            \n            for mtruuid in metrics.find_objuuids(type = \"localhost memory\"):\n                metric = metrics.get_object(mtruuid)\n                \n                grid_data.append({\"timestamp\" : metric.object[\"timestamp\"], \\\n                                  \"total\" : int(metric.object[\"mem\"][\"total\"]), \\\n                                  \"used\" : int(metric.object[\"mem\"][\"used\"]), \\\n                                  \"free\" : int(metric.object[\"mem\"][\"free\"]), \\\n                                  \"cache\" : int(metric.object[\"mem\"][\"buff/cache\"]), \\\n                                  \"free+cache\" : int(metric.object[\"mem\"][\"buff/cache\"]) + int(metric.object[\"mem\"][\"free\"]), \\\n                                  \"datetime\" : strftime('%Y-%m-%d %H:%M:%S', localtime(int(metric.object[\"timestamp\"])))})\n                \n            # Insertion sort by dictionary key \"timestamp\"\n            for i in range(0, len(grid_data)):\n                for j in range(i, len(grid_data)):\n                    if int(grid_data[i][\"timestamp\"]) > int(grid_data[j][\"timestamp\"]):\n                        grid_data[i], grid_data[j] = grid_data[j], grid_data[i]\n            \n            self.output.append(chart_page_1 + json.dumps(grid_data) + chart_page_2)\n            \n            self.status = STATUS_INFORMATION\n        except Exception:\n            self.output.append(traceback.format_exc())\n            self.status = STATUS_EXCEPTION\n\n        return self.status", 
        "changed": false, 
        "children": [], 
        "coluuid": "b39c6734-5409-8aed-e945-72e783dc42ec", 
        "context": {
            "copy": {
                "action": {
                    "method": "copy node", 
                    "params": {
                        "objuuid": "417ec7b1-4a2d-614d-0a5a-19dd3b43ab65"
                    }, 
                    "route": "inventory/ajax_copy_object"
                }, 
                "label": "Copy"
            }, 
            "delete": {
                "action": {
                    "method": "delete node", 
                    "params": {
                        "objuuid": "417ec7b1-4a2d-614d-0a5a-19dd3b43ab65"
                    }, 
                    "route": "inventory/ajax_delete"
                }, 
                "label": "Delete"
            }, 
            "edit": {
                "action": {
                    "method": "edit task", 
                    "params": {
                        "objuuid": "417ec7b1-4a2d-614d-0a5a-19dd3b43ab65"
                    }, 
                    "route": "inventory/ajax_get_object"
                }, 
                "label": "Edit"
            }, 
            "edit hosts": {
                "action": {
                    "method": "edit task hosts", 
                    "params": {
                        "objuuid": "417ec7b1-4a2d-614d-0a5a-19dd3b43ab65"
                    }, 
                    "route": "inventory/ajax_get_object"
                }, 
                "label": "Edit Hosts"
            }, 
            "run": {
                "action": {
                    "method": "run task", 
                    "params": {
                        "objuuid": "417ec7b1-4a2d-614d-0a5a-19dd3b43ab65"
                    }, 
                    "route": "inventory/ajax_get_object"
                }, 
                "label": "Run"
            }
        }, 
        "hosts": [
            "25242bdb-9db1-e016-35a0-1b5d03cde01d"
        ], 
        "icon": "/images/task_icon.png", 
        "name": "Display Localhost Memory Metrics", 
        "objuuid": "417ec7b1-4a2d-614d-0a5a-19dd3b43ab65", 
        "parent": "1dd45b8b-eeca-4240-3960-868ad6adc556", 
        "type": "task"
    }
}